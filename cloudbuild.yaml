steps:
- name: 'gcr.io/cloud-builders/docker'
  id: Build
  entrypoint: bash
  args:
    - -c
    - |
      docker build . -t europe-west3-docker.pkg.dev/$PROJECT_ID/webapp/wordblend:latest \
      && docker push europe-west3-docker.pkg.dev/$PROJECT_ID/webapp/wordblend:latest \

- name: 'gcr.io/google.com/cloudsdktool/cloud-sdk'
  entrypoint: gcloud
  args: ['run', 'deploy', $PROJECT_ID,
             --image=europe-west3-docker.pkg.dev/$PROJECT_ID/webapp/wordblend:latest,
             '--region=europe-west3', '--service-account=firebase-adminsdk-jfp0o@wordblend-ai.iam.gserviceaccount.com',
              '--set-env-vars=FLASK_APP=main.py,PRODUCTION=True']
images:
- 'europe-west3-docker.pkg.dev/$PROJECT_ID/webapp/wordblend:latest'